# 微信公众号编辑器项目分析

## 项目规则
1. **本地开发原则**
   - 暂时保持为本地项目
   - 不引入过多服务器动作
   - 可以获取必要的在线组件

2. **开发者友好**
   - 开发者是编程新手
   - CSS 和 HTML 掌握基本语法
   - JS 不太熟悉，需要引导
   - 需要解释语法使用限制和规则

3. **组件使用原则**
   - 尽量减少组件引入
   - 避免使用不确定可用性的组件
   - 优先使用稳定可靠的方案

4. **文件系统管理**
   - 保持文件系统干净
   - 避免创建过多文件
   - 优先合并逻辑到现有文件
   - 仅在效率明显提升时才分离文件

5. **功能开发原则**
   - 先检查功能可用性
   - 提供清晰的 debug 步骤
   - 确保功能稳定性

6. **微信公众号平台限制**
   - 输出为富文本格式
   - 样式内联到 HTML 标签
   - 需要考虑平台限制
   - 及时提醒可能的限制问题

7. **创新解决方案**
   - 当常规方案不可行时考虑创新方案
   - 可以使用非推荐但有效的方案
   - 例如：使用 display:inline-grid 和 grid area 实现特殊布局

8. **扩展性考虑**
   - 保留引入更多规则的可能性
   - 保持代码的可扩展性

## 项目架构
1. **前端部分**
   - 浏览器中运行的编辑器界面
   - 使用 HTML + CSS + JS
   - 主要文件：orca.html, orca.js, function.css

2. **后端部分**
   - Node.js 服务器（momOrca.js）
   - 处理文件系统操作
   - 提供 API 接口

3. **通信方式**
   - 前端通过 API 调用与后端交互
   - 主要 API：
     - /api/articles：获取文件目录树
     - /api/article：获取 Markdown 文件内容

## 样式文件组织
1. **orca.css**
   - 专门用于文章正文样式
   - 只包含 .note-to-mp 类下的样式
   - 用于最终的内联样式处理
   - 不包含任何 UI 组件、布局、交互样式

2. **function.css**
   - 包含所有 UI 相关样式
   - 处理布局、交互、组件样式
   - 不参与文章内容的内联处理

3. **样式分离原则**
   - 严格区分文章样式和 UI 样式
   - 确保内联样式时只处理必要的样式
   - 避免样式污染和冲突

## 微信公众号特殊限制
1. **样式限制**
   - 不支持外部 CSS 文件
   - 不支持某些 CSS 特性（如某些伪元素）
   - 需要内联所有样式
   - 背景图片需要转换为 <img> 标签

2. **特殊处理步骤**
   - 展开 CSS 变量（使用 postcss-custom-properties）
   - 使用 juice 进行样式内联
   - 特殊处理 h2 标题的伪元素（数字补零和背景图片转换）
   - 处理 SVG 伪元素
   - 移除外部 CSS 引用

## 当前问题
1. **模块化问题**
   - 添加了 ES 模块语法（import/export）
   - 但项目实际使用传统的脚本引入方式
   - markdown-it 和 markdownitMark 在 HTML 中通过 <script> 标签引入

2. **构建系统**
   - 有 webpack 配置但项目不依赖它
   - 使用简单的静态文件服务

3. **依赖处理**
   - juice 的使用方式需要调整
   - 需要保持与 inline-orca.js 相同的处理逻辑

## 修复计划
1. **代码调整**
   - 回退模块化改动
   - 改回使用传统的脚本引入方式
   - 调整 juice 的使用方式

2. **功能完善**
   - 调整 clipboard-utils.js 的实现
   - 加入特殊处理逻辑
   - 改进复制功能

3. **保持兼容**
   - 确保与原有处理逻辑一致
   - 维持文件结构
   - 保持依赖关系

## 参考文件
1. **核心文件**
   - momOrca.js：后端实现
   - orca.js：前端主要逻辑
   - function.css：UI 样式定义
   - orca.css：文章样式定义

2. **特殊处理文件**
   - inline-orca.js：内联样式处理
   - orca-inlined.html：处理后的静态文件
   - copyToWeChat.js：复制功能实现 